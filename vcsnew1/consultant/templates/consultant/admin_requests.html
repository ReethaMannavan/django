<!-- 
{% extends 'base.html' %}
{% block title %}Consultant Requests{% endblock %}

{% block content %}
<h2>Consultant Requests</h2>

<table class="table table-bordered">
  <thead>
    <tr>
      <th>User</th>
      <th>Purpose</th>
      <th>Status</th>
      <th>SLA</th>
      <th>Change Status</th>
      <th>Date</th>
    </tr>
  </thead>

  <tbody>
    {% for item in requests %}
    <tr>
      <td>{{ item.req.user.username }}</td>
      <td>{{ item.req.purpose }}</td>
      <td>{{ item.req.status }}</td>

      <td>
        {% if item.sla_status == "overdue" %}
          <span class="badge bg-danger">Overdue</span>
        {% elif item.sla_status == "warning" %}
          <span class="badge bg-warning">Due Soon</span>
        {% else %}
          <span class="badge bg-success">OK</span>
        {% endif %}
      </td>

      <td>
        <form method="POST">
          {% csrf_token %}
          <input type="hidden" name="request_id" value="{{ item.req.id }}">
          <select name="status">
            <option value="pending">Pending</option>
            <option value="in_progress">In Progress</option>
            <option value="completed">Completed</option>
          </select>
          <button type="submit">Update</button>
        </form>
      </td>

      <td>{{ item.req.created_at|date:"M d, Y" }}</td>
    </tr>

    {% empty %}
    <tr>
      <td colspan="6">No consultant requests yet.</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

{% endblock %} -->


{% extends 'base.html' %}
{% block title %}Consultant Requests{% endblock %}

{% block content %}
<div class="container py-4">

  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="fw-bold m-0">Consultant Requests</h2>
    <span class="badge bg-dark">Sorted by Priority + Oldest</span>
  </div>

  <div class="table-responsive">
    <table class="table table-bordered align-middle">
      <thead class="table-light">
        <tr>
          <th>User</th>
          <th>Tier</th>
          <th>Purpose</th>
          <th>Status</th>
          <th>SLA</th>
          <th>Deadline</th>
          <th style="width:220px;">Change Status</th>
          <th>Date</th>
        </tr>
      </thead>

      <tbody>
        {% for item in requests %}
        <tr>
          <td>{{ item.req.user.username }}</td>
          <td>
            <span class="badge {% if item.req.user.subscription_tier == 'pro_plus' %}bg-success{% else %}bg-primary{% endif %}">
              {{ item.req.user.subscription_tier|upper }}
            </span>
          </td>
          <td>{{ item.req.purpose }}</td>
          <td>
            <span class="badge
              {% if item.req.status == 'pending' %}bg-secondary
              {% elif item.req.status == 'in_progress' %}bg-warning text-dark
              {% else %}bg-success{% endif %}">
              {{ item.req.status|capfirst }}
            </span>
          </td>

          <td>
            {% if item.sla_status == "overdue" %}
              <span class="badge bg-danger">Overdue</span>
            {% elif item.sla_status == "warning" %}
              <span class="badge bg-warning text-dark">Due Soon</span>
            {% else %}
              <span class="badge bg-success">OK</span>
            {% endif %}
          </td>

          <td>{{ item.deadline|date:"M d, Y H:i" }}</td>

          <td>
            <form method="POST" class="d-flex gap-2">
              {% csrf_token %}
              <input type="hidden" name="request_id" value="{{ item.req.id }}">
              <select name="status" class="form-select form-select-sm">
                <option value="pending" {% if item.req.status == "pending" %}selected{% endif %}>Pending</option>
                <option value="in_progress" {% if item.req.status == "in_progress" %}selected{% endif %}>In Progress</option>
                <option value="completed" {% if item.req.status == "completed" %}selected{% endif %}>Completed</option>
              </select>
              <button class="btn btn-sm btn-primary">Update</button>
            </form>
          </td>

          <td>{{ item.req.created_at|date:"M d, Y" }}</td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="8" class="text-center text-muted py-4">
            No consultant requests yet.
          </td>
        </tr>
        {% endfor %}
      </tbody>

    </table>
  </div>

</div>
{% endblock %}
