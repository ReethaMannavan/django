{% extends 'events/base.html' %}
{% block title %}{{ event.title }}{% endblock %}
{% block content %}
<div class="row">
  <div class="col-md-8">
    <h2>{{ event.title }}</h2>
    <p class="text-muted">{{ event.date|date:"SHORT_DATETIME_FORMAT" }} â€¢ Organized by {{ event.organizer.username }}</p>
    {% if event.image %}<img src="{{ event.image.url }}" class="img-fluid mb-3" alt="poster">{% endif %}
    <div>{{ event.description|linebreaks }}</div>
  </div>
  <div class="col-md-4">
    <h5>Actions</h5>
    {% if user.is_authenticated %}
      {% if is_registered %}
        <form method="post" action="{% url 'events:event_unregister' event.pk %}">
          {% csrf_token %}
          <button class="btn btn-outline-danger w-100">Unregister</button>
        </form>
      {% else %}
        <form method="post" action="{% url 'events:event_register' event.pk %}">
          {% csrf_token %}
          <button class="btn btn-success w-100">Register</button>
        </form>
      {% endif %}
      {% if user == event.organizer %}
        <hr>
        <a class="btn btn-sm btn-warning w-100 mb-2" href="{% url 'events:event_edit' event.pk %}">Edit</a>
        <form method="post" action="{% url 'events:event_delete' event.pk %}">
          {% csrf_token %}
          <button class="btn btn-sm btn-danger w-100">Delete</button>
        </form>
      {% endif %}
    {% else %}
      <p><a href="{% url 'login' %}?next={{ request.path }}">Log in</a> to register.</p>
    {% endif %}

    <hr>
    <h6>Registered</h6>
    <ul class="list-unstyled">
      {% for reg in registrations %}
        <li>{{ reg.user.username }} {% if reg.status == 'CANCELLED' %}<small class="text-muted">(cancelled)</small>{% endif %}</li>
      {% empty %}
        <li>No registrations yet.</li>
      {% endfor %}
    </ul>
  </div>
</div>
{% endblock %}
